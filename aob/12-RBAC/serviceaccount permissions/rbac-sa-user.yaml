There is existing Namespace applications .

1. User smoke should be allowed to create and delete Pods, Deployments and StatefulSets in Namespace applications.
2. User smoke should have view permissions (like the permissions of the default ClusterRole named view ) in all Namespaces but not in kube-system .
3. User smoke should be allowed to retrieve available Secret names in Namespace applications. Just the Secret names, no data.
4. Verify everything using kubectl auth can-i .

k create clusterrole create-delete-pods --verb=create,delete --resource=pods --resource=deployments.apps --resource=statefulsets.apps
k create clusterrolebinding create-delete-pods-smoke --clusterrole=create-delete-pods --user=smoke -n applications

## soln:
## 1.
k -n applications create role smoke --verb create,delete --resource pods,deployments,sts
k -n applications create rolebinding smoke --role smoke --user smoke

## 2.
k get ns # get all namespaces
k -n applications create rolebinding smoke-view --clusterrole view --user smoke
k -n default create rolebinding smoke-view --clusterrole view --user smoke
k -n kube-node-lease create rolebinding smoke-view --clusterrole view --user smoke
k -n kube-public create rolebinding smoke-view --clusterrole view --user smoke

## 3.
This is NOT POSSIBLE using plain K8s RBAC. You might think of doing this:

# NOT POSSIBLE: assigning "list" also allows user to read secret values
k -n applications create role list-secrets --verb list --resource secrets

k -n applications create rolebinding ...

Having the list verb you can simply run kubectl get secrets -oyaml and see all content. Dangerous misconfiguration!


## 4.
# applications
k auth can-i create deployments --as smoke -n applications # YES
k auth can-i delete deployments --as smoke -n applications # YES
k auth can-i delete pods --as smoke -n applications # YES
k auth can-i delete sts --as smoke -n applications # YES
k auth can-i delete secrets --as smoke -n applications # NO
k auth can-i list deployments --as smoke -n applications # YES
k auth can-i list secrets --as smoke -n applications # NO
k auth can-i get secrets --as smoke -n applications # NO

# view in all namespaces but not kube-system
k auth can-i list pods --as smoke -n default # YES
k auth can-i list pods --as smoke -n applications # YES
k auth can-i list pods --as smoke -n kube-public # YES
k auth can-i list pods --as smoke -n kube-node-lease # YES
k auth can-i list pods --as smoke -n kube-system # NO


